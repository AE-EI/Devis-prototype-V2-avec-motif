<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Kill Service Worker</title>
</head>
<body>
<h1>Suppression du cache Service Worker</h1>
<p>Nettoyage en cours...</p>

<script>
(async () => {
  try {
    const regs = await navigator.serviceWorker.getRegistrations();
    for (let reg of regs) {
      await reg.unregister();
      console.log("SW unregistered:", reg);
    }
    if ('caches' in window) {
      const names = await caches.keys();
      for (let name of names) {
        await caches.delete(name);
        console.log("Cache supprim√©:", name);
      }
    }
    // Redirection vers la cible (param ?to=)
    const params = new URLSearchParams(location.search);
    const to = params.get("to") || "";
    const v = params.get("v") || Date.now();
    if (to) {
      location.href = `${to}?nocache=${v}`;
    } else {
      document.body.innerHTML += "<p>Aucune URL fournie pour redirection.</p>";
    }
  } catch (e) {
    console.error(e);
    document.body.innerHTML += "<p>Erreur: " + e + "</p>";
  }
})();
</script>
</body>
</html>
