<!DOCTYPE html>
<html lang="fr">
<head>
  <!-- ============================= -->
  <!-- CHAPITRE 1 : STRUCTURE & STYLES -->
  <!-- ============================= -->
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MiniDevis ‚Äî V2.4 (doublons pi√®ces + tableau complet)</title>
  <style>
    :root { --bg:#f6f6f6; --card:#fff; --txt:#111; --muted:#666; --line:#e8e8e8; --primary:#111; }
    *{ box-sizing:border-box }
    body{ margin:0; font-family:Arial, Helvetica, sans-serif; color:var(--txt); background:var(--bg); }
    header{ position:sticky; top:0; z-index:10; background:var(--primary); color:#fff; padding:10px 14px; font-weight:700; text-align:center; }
    main{ max-width:980px; margin:0 auto; padding:16px; }
    h2{ margin:8px 0 12px; }
    .row{ display:flex; gap:8px; flex-wrap:wrap; }
    .grid-qty{ display:grid; grid-template-columns:repeat(6,56px); gap:8px; }
    .btn{ padding:10px 14px; font-size:16px; background:#eee; border:1px solid #ccc; border-radius:8px; cursor:pointer; }
    .btn.primary{ background:#111; color:#fff; border-color:#000; }
    .btn.back{ background:#ddd; }
    .btn.ghost{ background:#fff; }
    .card{ background:var(--card); border:1px solid var(--line); border-radius:12px; padding:14px; margin-bottom:12px; }
    .muted{ color:var(--muted); }
    pre{ white-space:pre-wrap; background:var(--card); border:1px solid var(--line); padding:12px; border-radius:10px; }
    input, select, textarea{ width:100%; padding:10px; font-size:16px; border:1px solid #ccc; border-radius:8px; }
    .list{ display:flex; flex-direction:column; gap:8px; }
    .pill{ display:inline-flex; align-items:center; gap:8px; padding:8px 10px; border:1px solid var(--line); border-radius:999px; background:#fff; }
    .pill small{ color:var(--muted); }
    .badge{ display:inline-block; padding:2px 8px; border:1px solid var(--line); border-radius:999px; font-size:12px; color:#444; background:#fafafa; }
  </style>

  <!-- JSZip (export ZIP) -->
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>

  <!-- Cache-busting doux : ajoute ?v=timestamp si absent -->
  <script>
  (function(){
    try{
      var u = new URL(location.href);
      if(!u.searchParams.has('v')){
        u.searchParams.set('v', Date.now());
        location.replace(u.toString());
      }
    }catch(e){}
  })();
  </script>
</head>
<body>
<header>MiniDevis ‚Äî V2.4</header>
<main id="app"></main>

<script>
/* ============================= */
/* DEBUG GLOBAL : surface les erreurs au lieu d‚Äôun √©cran vide */
/* ============================= */
window.addEventListener('error', (e) => {
  const el = document.getElementById('app');
  if (el) el.innerHTML =
    `<div class="card"><h2>Erreur JS</h2><pre>${e.message}\n${e.filename}:${e.lineno}:${e.colno}</pre></div>`;
});

/* ============================= */
/* CHAPITRE 2 : √âTAT & HELPERS UI */
/* ============================= */

// √âtat global
let devis = {}; // contiendra aussi __id, __name
let ctx = { piece:null, category:null, intervention:null, pose:null, designation:null };

// IDs
function genId(){ return 'dv_' + Math.random().toString(36).slice(2) + Date.now().toString(36); }
function ensureId(){ if(!devis.__id) devis.__id = genId(); }

// DOM & helpers
const $app = () => document.getElementById('app');
function b(label, fn, cls="btn"){ return `<button class="${cls}" onclick="${fn}">${label}</button>`; }
function euro(n){ return `${(+n).toFixed(2)} ‚Ç¨`; }

// ---------------- DOUBLONS DE PI√àCES : cl√©s uniques + base pour groupage ----------------
// Construit le libell√© d‚Äôaffichage (sans suffixe auto)
function buildPieceLabel(base, qualif, etage){
  let lbl = base;
  if (qualif && qualif.trim()) lbl += " (" + qualif.trim() + ")";
  if (etage && etage.trim()) lbl += " ‚Äî " + etage.trim();
  return lbl;
}
// Trouve une cl√© libre en ajoutant (2), (3)... si n√©cessaire
function nextFreeKey(label){
  if (!devis[label]) return label;
  let n = 2;
  while (devis[`${label} (${n})`]) n++;
  return `${label} (${n})`;
}
// Cr√©e (ou r√©cup√®re) une pi√®ce distincte √† partir du trio (base, qualif, √©tage)
function createOrGetPiece(base, qualif, etage){
  const wanted = buildPieceLabel(base, qualif, etage);
  const key = nextFreeKey(wanted);
  if (!devis[key]) {
    devis[key] = { __base: base, qualificatif: (qualif||""), etage: (etage||""), items:[], note:"" };
    saveLocal();
  }
  return key;
}
// Affichage du libell√© enrichi √† partir des m√©tas (et non de la cl√© brute)
function formatPieceLabel(pieceKey){
  const s = devis[pieceKey];
  if (!s) return pieceKey;
  const base = s.__base || pieceKey; // fallback anciens devis
  return buildPieceLabel(base, s.qualificatif, s.etage);
}

// Footer auto (peut √™tre masqu√©)
function view(html, noFooter=false){
  let out = html;
  if(!noFooter){
    out += `
      <div class="row" style="margin-top:16px; gap:12px;">
        ${b("‚¨ÖÔ∏è Accueil","confirmBackHome()","btn back")}
        ${b("üíæ Sauvegarder devis","saveCurrentDevis()","btn primary")}
      </div>
    `;
  }
  $app().innerHTML = out;
}

// Confirmation retour menu
function confirmBackHome(){
  const hasData = Object.keys(devis)
    .filter(k => !k.startsWith('__'))
    .some(k => (devis[k]?.items?.length||0) > 0 || (devis[k]?.note?.trim()?.length||0) > 0);
  if(!hasData || confirm("Revenir au menu principal ?\n‚ö†Ô∏è Les modifications non sauvegard√©es seront perdues.")){
    pageMain();
  }
}

// Persistance locale
function ensureSection(pieceKey){
  if(!devis[pieceKey]) devis[pieceKey] = { items:[], note:"", qualificatif:"", etage:"" };
}
function saveLocal(){ try{ localStorage.setItem('devis', JSON.stringify(devis)); }catch(e){} }
function loadLocal(){
  try{ devis = JSON.parse(localStorage.getItem('devis')||'{}') || {}; } catch(e){ devis = {}; }
  ensureId();
}

/* ============================= */
/* CHAPITRE 3 : DONN√âES & CONSTANTES */
/* ============================= */
const PIECES_PREDEFINIES = [
  "Salon","Cuisine","Salle √† manger","Salle de bain","Salle d'eau",
  "Chambre 1","Chambre 2","Chambre 3","Toilettes","Bureau",
  "Buanderie","Garage","Couloir","Terrasse","Balcon","Jardin",
  "D√©barras","Ext√©rieur","Grenier/Combles","Atelier","Abri de jardin","Entr√©e","Biblioth√®que"
];
const CATEGORIES = ["Prises","√âclairage","Circuit sp√©cialis√©"];
const POSES = ["Encastr√© ma√ßonnerie","Placo","Semi-encastr√©","Sur-mesure","Saillie avec moulure","Sous tube IRL"];
const DESIGNATIONS_PAR_CATEGORIE = {
  "Prises": ["Prise"],
  "√âclairage/Luminaires": ["Point de centre","Applique"],
  "√âclairage/Commandes": ["Interrupteur simple","Interrupteur double"],
  "Circuit sp√©cialis√©": [
    "Four","Plaque de cuisson","Lave-linge","Lave-vaisselle","S√®che-linge","Cumulus",
    "VMC","Chauffage","Climatisation","Prise ext√©rieure √©tanche","Autre circuit sp√©cialis√©"
  ]
};
const TARIFS = {
  "Prise": { creation:120, recablage_sans:50, recablage_avec:70, remplacement:20 },
  "Point de centre": { creation:100, recablage_sans:50, recablage_avec:75, remplacement:30 },
  "Applique": { creation:100, recablage_sans:50, recablage_avec:75, remplacement:30 },
  "Interrupteur simple": { creation:40, recablage_sans:50, recablage_avec:75, remplacement:25 },
  "Interrupteur double": { creation:60, recablage_sans:50, recablage_avec:85, remplacement:35 },
  "Four": { creation:140, recablage_sans:70, recablage_avec:90, remplacement:40 },
  "Plaque de cuisson": { creation:140, recablage_sans:70, recablage_avec:90, remplacement:40 },
  "Lave-linge": { creation:140, recablage_sans:70, recablage_avec:90, remplacement:40 },
  "Lave-vaisselle": { creation:140, recablage_sans:70, recablage_avec:90, remplacement:40 },
  "S√®che-linge": { creation:140, recablage_sans:70, recablage_avec:90, remplacement:40 },
  "Cumulus": { creation:140, recablage_sans:70, recablage_avec:90, remplacement:40 },
  "VMC": { creation:140, recablage_sans:70, recablage_avec:90, remplacement:40 },
  "Chauffage": { creation:140, recablage_sans:70, recablage_avec:90, remplacement:40 },
  "Climatisation": { creation:140, recablage_sans:70, recablage_avec:90, remplacement:40 },
  "Prise ext√©rieure √©tanche": { creation:140, recablage_sans:70, recablage_avec:90, remplacement:40 },
  "Autre circuit sp√©cialis√©": { creation:140, recablage_sans:70, recablage_avec:90, remplacement:40 }
};
const ETAGES = ["Rez-de-chauss√©e","1er √©tage","2e √©tage","Sous-sol","Combles","Annexe"];

/* ============================= */
/* CHAPITRE 4 : MENU PRINCIPAL */
/* ============================= */
function pageMain(){
  view(`
    <div class="card">
      <h2>Menu principal</h2>
      <div class="row">
        ${b("‚ûï Nouveau devis","actionNouveauDevis()","btn primary")}
        ${b("üìÇ Mes devis sauvegard√©s","pageSavedDevis()")}
      </div>
    </div>
  `, true);
}
function actionNouveauDevis(){
  devis = { __id: genId(), __name:"" };
  saveLocal();
  pageHome();
}
function pageSavedDevis(){
  const saved = JSON.parse(localStorage.getItem("savedDevisList")||"[]");
  if(!saved.length){
    return view(`<div class="card">
      ${b("Retour","pageMain()","btn back")}
      <h2>Mes devis sauvegard√©s</h2>
      <p class="muted">Aucun devis sauvegard√©.</p>
    </div>`, true);
  }
  const list = saved.map((d,i)=>`<div class="pill">
      <strong>${d.name}</strong> <small>${d.date}</small>
      ${b("Ouvrir",\`loadDevis(${i})\`)} ${b("Supprimer",\`deleteDevis(${i})\`,"btn")}
    </div>`).join('');
  view(`<div class="card">
      ${b("Retour","pageMain()","btn back")}
      <h2>Mes devis sauvegard√©s</h2>
      <div class="list">${list}</div>
  </div>`, true);
}
function loadDevis(idx){
  const saved = JSON.parse(localStorage.getItem("savedDevisList")||"[]");
  if(!saved[idx]) return pageSavedDevis();
  devis = saved[idx].data || {};
  ensureId(); saveLocal();
  pageHome();
}
function deleteDevis(idx){
  if(!confirm("Supprimer ce devis sauvegard√© ?")) return;
  const saved = JSON.parse(localStorage.getItem("savedDevisList")||"[]");
  saved.splice(idx,1);
  localStorage.setItem("savedDevisList", JSON.stringify(saved));
  pageSavedDevis();
}
function saveCurrentDevis(){
  ensureId();
  let saved = JSON.parse(localStorage.getItem("savedDevisList")||"[]");

  // Remplace si m√™me ID
  let i = saved.findIndex(d => d.data && d.data.__id === devis.__id);
  if (i >= 0){
    const name = devis.__name || saved[i].name || ("Devis " + new Date().toLocaleDateString());
    devis.__name = name;
    saved[i] = { name, date:new Date().toLocaleDateString(), data:devis };
    localStorage.setItem("savedDevisList", JSON.stringify(saved));
    alert("Devis mis √† jour."); return;
  }
  // Sinon demande le nom ; propose √©crasement si m√™me NOM
  let name = (devis.__name || "").trim();
  if(!name){
    name = (prompt("Nom du devis :","") || "").trim();
    if(!name){ alert("Sauvegarde annul√©e."); return; }
  }
  const j = saved.findIndex(d => (d.name||"").toLowerCase() === name.toLowerCase());
  devis.__name = name;
  if (j >= 0){
    if(!confirm(`Un devis ¬´ ${name} ¬ª existe d√©j√†. L'√©craser ?`)) return;
    saved[j] = { name, date:new Date().toLocaleDateString(), data:devis };
  }else{
    saved.push({ name, date:new Date().toLocaleDateString(), data:devis });
  }
  localStorage.setItem("savedDevisList", JSON.stringify(saved));
  alert("Devis sauvegard√© !");
}

/* ============================= */
/* CHAPITRE 5 : ACCUEIL & FLUX PI√àCES */
/* ============================= */
function pageHome(){
  const list = Object.keys(devis).filter(k=>!k.startsWith('__'));
  const listHtml = list.length
    ? list.map(p=>{
        const s = devis[p] || {};
        const badges = [
          (s.qualificatif && s.qualificatif.trim()) ? `<span class="badge">${s.qualificatif}</span>` : "",
          (s.etage && s.etage.trim()) ? `<span class="badge">${s.etage}</span>` : ""
        ].filter(Boolean).join(" ");
        return `<div class="pill">
          <strong>${formatPieceLabel(p)}</strong>
          <small>${(s.items||[]).length} ligne(s)</small>
          ${badges}
          ${b("Ouvrir", \`goPiece("${p.replace(/"/g,'&quot;')}")\`)}
          ${b("Supprimer", \`removePiece("${p.replace(/"/g,'&quot;')}")\`, "btn")}
        </div>`;
      }).join('')
    : `<p class="muted">Aucune pi√®ce ajout√©e pour l‚Äôinstant.</p>`;

  view(`
    <div class="card">
      <h2>Accueil</h2>
      <div class="row">
        ${b("Ajouter une pi√®ce","pageAddPiece()","btn primary")}
        ${b("Installations sp√©cifiques","pageISHome()","btn")}
      </div>
    </div>
    <div class="card" style="margin-top:12px;">
      <h2>Pi√®ces ajout√©es</h2>
      <div class="list">${listHtml}</div>
    </div>
    <div class="row" style="margin-top:12px;">
      ${b("Voir l‚Äôestimatif","pageEstimatif()")}
      ${b("Voir les totaux","pageTotaux()")}
    </div>
  `);
}
function pageAddPiece(){
  const options = PIECES_PREDEFINIES.map(p=>`<option value="${p}">${p}</option>`).join('')
                 + `<option value="__NEW__">‚ûï Cr√©er une nouvelle pi√®ce‚Ä¶</option>`;
  const etageOptions = ["(aucun)",...ETAGES].map(e=>`<option value="${e}">${e}</option>`).join('');

  view(`
    <div class="card">
      ${b("Retour","pageHome()","btn back")}
      <h2>Ajouter une pi√®ce</h2>
      <label>Choisir une pi√®ce</label>
      <select id="piece-choice">${options}</select>
      <label style="margin-top:10px;">Qualificatif (optionnel)</label>
      <input id="piece-qualif" placeholder="ex : Parents, RDC, gauche" />
      <label style="margin-top:10px;">√âtage (optionnel)</label>
      <select id="piece-etage">${etageOptions}</select>
      <div class="row" style="margin-top:10px;">
        ${b("Valider","confirmPieceChoice()","btn primary")}
      </div>
    </div>
  `);
}
function confirmPieceChoice(){
  const sel    = document.getElementById('piece-choice').value;
  const qualif = (document.getElementById('piece-qualif').value || "").trim();
  const etage  = document.getElementById('piece-etage').value;
  if(!sel) return;

  let base = sel;
  if(sel==="__NEW__"){
    base = (prompt("Nom de la pi√®ce :","") || "").trim();
    if(!base) return;
  }
  const etageVal = (etage && etage!=="(aucun)") ? etage : "";
  const key = createOrGetPiece(base, qualif, etageVal);
  goPiece(key);
}
function removePiece(pieceKey){
  if(confirm(`Supprimer la pi√®ce ¬´ ${formatPieceLabel(pieceKey)} ¬ª et toutes ses lignes ?`)){
    delete devis[pieceKey]; saveLocal(); pageHome();
  }
}
function goPiece(pieceKey){
  ctx = { piece:pieceKey, category:null, intervention:null, pose:null, designation:null };
  ensureSection(pieceKey);

  const cats = CATEGORIES
    .filter(cat => cat !== "Sp√©cifique")
    .map(cat => b(cat, \`goCategory("${cat}")\`)).join('');

  const s = devis[pieceKey];
  const noteTxt = s.note
    ? `<em class="muted">Note : ${s.note}</em>`
    : `<span class="muted">Aucune note</span>`;

  const lignes = (s.items||[]).length
    ? `<ul>` + s.items.map((it,i)=>{
        const total = (+it.prixU||0) * (+it.qty||0);
        const poseTxt = (it.intervention==="Cr√©ation" && it.pose) ? \` ‚Äî \${it.pose.toLowerCase()}\` : "";
        const unitTxt = it.unit || "u";
        return `<li>
          ${it.intervention ? it.intervention + " ‚Äî " : ""}${it.designation}${poseTxt}
          (${it.qty} ${unitTxt} √ó ${euro(it.prixU)} = ${euro(total)})
          ${b("√ó",\`delLine("${pieceKey.replace(/"/g,'&quot;')}",${i})\`,"btn")}
        </li>`;
      }).join('') + `</ul>`
    : `<p class="muted">Aucune ligne pour l‚Äôinstant.</p>`;

  view(`
    <div class="card">
      ${b("Retour","pageHome()","btn back")}
      <h2>${formatPieceLabel(pieceKey)}</h2>
      <div class="row">
        ${cats}
        ${b("Sp√©cifique","pagePieceSpecifique()","btn ghost")}
      </div>
      <div class="row" style="margin-top:10px;">
        ${b("Ajouter / modifier la note","editPieceNote()")}
      </div>
    </div>
    <div class="card" style="margin-top:12px;">
      <h2>Lignes de la pi√®ce</h2>
      ${lignes}
      <p style="margin-top:8px;">${noteTxt}</p>
    </div>
  `);
}
function delLine(pieceKey, idx){
  (devis[pieceKey].items||[]).splice(idx,1); saveLocal(); goPiece(pieceKey);
}
function goCategory(cat){
  ctx.category = cat;
  if (cat === "√âclairage") return goEclairageSub();
  let interventions = [];
  if (cat === "Prises" || cat === "Circuit sp√©cialis√©"){
    interventions = ["Cr√©ation","Remplacement appareillage","Rec√¢blage avec remplacement appareillage","Rec√¢blage sans remplacement appareillage"];
  } else if (cat === "Sp√©cifique"){
    interventions = ["Saisie libre avec prix"];
  } else {
    interventions = ["Cr√©ation"];
  }
  const btns = interventions.map(i=> b(i, \`goIntervention("${i}")\`)).join('');
  view(`
    <div class="card">
      ${b("Retour",\`goPiece("${ctx.piece.replace(/"/g,'&quot;')}")\`,"btn back")}
      <h2>${ctx.category} ‚Äî ${formatPieceLabel(ctx.piece)}</h2>
      <div class="row">${btns}</div>
    </div>
  `);
}
function goEclairageSub(){
  view(`
    <div class="card">
      ${b("Retour",\`goPiece("${ctx.piece.replace(/"/g,'&quot;')}")\`,"btn back")}
      <h2>√âclairage ‚Äî ${formatPieceLabel(ctx.piece)}</h2>
      <div class="row">
        ${b("Luminaires",\`setEclairageBranch("√âclairage/Luminaires")\`)}
        ${b("Commandes",\`setEclairageBranch("√âclairage/Commandes")\`)}
      </div>
    </div>
  `);
}
function setEclairageBranch(branch){
  ctx.category = branch;
  const interventions = (branch==="√âclairage/Luminaires")
    ? ["Cr√©ation","Remplacement luminaire","Rec√¢blage avec remplacement luminaire","Rec√¢blage sans remplacement luminaire"]
    : ["Cr√©ation","Remplacement appareillage","Rec√¢blage avec remplacement appareillage","Rec√¢blage sans remplacement appareillage"];
  const btns = interventions.map(i=> b(i, \`goIntervention("${i}")\`)).join('');
  view(`
    <div class="card">
      ${b("Retour","goEclairageSub()","btn back")}
      <h2>${branch} ‚Äî ${formatPieceLabel(ctx.piece)}</h2>
      <div class="row">${btns}</div>
    </div>
  `);
}
function goIntervention(interv){
  ctx.intervention = interv;
  if (ctx.category === "Sp√©cifique"){
    const label = prompt("Nom de la prestation sp√©cifique :",""); if(!label) return goCategory("Sp√©cifique");
    const prix = parseFloat(prompt("Prix estim√© (‚Ç¨) :","0"))||0;
    ensureSection(ctx.piece);
    devis[ctx.piece].items.push({ category:"Sp√©cifique", intervention:"", pose:"", designation:label, qty:1, prixU:prix });
    saveLocal(); return goPiece(ctx.piece);
  }
  const needsPose = ["Prises","Circuit sp√©cialis√©","√âclairage/Luminaires","√âclairage/Commandes"].includes(ctx.category);
  if (interv==="Cr√©ation" && needsPose){
    const poses = POSES.map(p=> b(p, \`goDesignation("${p}")\`)).join('');
    const back = (ctx.category.startsWith("√âclairage/") ? "√âclairage" : ctx.category);
    view(`<div class="card">${b("Retour",\`goCategory("${back}")\`,"btn back")}<h2>Type de pose</h2><div class="row">${poses}</div></div>`);
  } else {
    goDesignation(null);
  }
}
function goDesignation(pose){
  ctx.pose = pose;
  const list = DESIGNATIONS_PAR_CATEGORIE[ctx.category] || ["√âl√©ment"];
  if (list.length===1) return pageQuantite(list[0]);
  const btns = list.map(d=> b(d, \`pageQuantite("${d}")\`)).join('');
  view(`<div class="card">${b("Retour", ctx.intervention==="Cr√©ation"?\`goIntervention("${ctx.intervention}")\`:\`goCategory("${ctx.category}")\`,"btn back")}<h2>D√©signation</h2><div class="row">${btns}</div></div>`);
}
function pageQuantite(designation){
  ctx.designation = designation;
  const qtyBtns = Array.from({length:10},(_,i)=> b(i+1, \`saveItem(${i+1})\`)).join('');
  view(`<div class="card">${b("Retour",\`goDesignation("${ctx.pose||''}")\`,"btn back")}<h2>Quantit√©</h2><div class="grid-qty">${qtyBtns}</div></div>`);
}
function getPrix(designation, intervention){
  const base = TARIFS[designation] || {};
  if(intervention==="Cr√©ation") return base.creation||0;
  if(intervention?.includes("sans remplacement")) return base.recablage_sans||0;
  if(intervention?.includes("avec remplacement")) return base.recablage_avec||0;
  if(intervention?.startsWith("Remplacement")) return base.remplacement||0;
  return 0;
}
function saveItem(qty){
  ensureSection(ctx.piece);
  devis[ctx.piece].items.push({ category:ctx.category, intervention:ctx.intervention, pose:ctx.pose, designation:ctx.designation, qty, prixU:getPrix(ctx.designation, ctx.intervention) });
  saveLocal(); goPiece(ctx.piece);
}
function pagePieceSpecifique(){
  const label = prompt("Nom de la prestation sp√©cifique :",""); if(!label) return goPiece(ctx.piece);
  const prix = parseFloat(prompt("Prix estim√© (‚Ç¨) :","0"))||0;
  ensureSection(ctx.piece);
  devis[ctx.piece].items.push({ category:"Sp√©cifique", intervention:"", pose:"", designation:label, qty:1, prixU:prix });
  saveLocal(); goPiece(ctx.piece);
}
function editPieceNote(){
  ensureSection(ctx.piece);
  const cur = devis[ctx.piece].note || "";
  const n = prompt(`Note pour ${formatPieceLabel(ctx.piece)}`, cur);
  if(n!==null) devis[ctx.piece].note = n.trim();
  saveLocal(); goPiece(ctx.piece);
}

/* ============================= */
/* CHAPITRE 6 : TABLEAU & DISTRIBUTION (COMPLET) */
/* ============================= */

// Tout est stock√© sous la pi√®ce "Tableau"
function ensureTableau(){ ensureSection("Tableau"); if(!devis["Tableau"].__base) devis["Tableau"].__base = "Tableau"; }

// Hub ‚ÄúInstallations sp√©cifiques‚Äù
function pageISHome(){
  view(`
    <div class="card">
      ${b("Retour","pageHome()","btn back")}
      <h2>Installations sp√©cifiques</h2>
      <div class="row" style="margin-top:10px;">
        ${b("Mise √† la terre","isSoon('Mise √† la terre')")}
        ${b("VMC","isSoon('VMC')")}
        ${b("Tableau / distribution","pageTabHome()","btn primary")}
      </div>
      <p class="muted" style="margin-top:8px;">Les modules ‚ÄúMise √† la terre‚Äù et ‚ÄúVMC‚Äù arrivent bient√¥t.</p>
    </div>
  `);
}
function isSoon(x){ alert(x + " : module √† venir."); }

// Hub ‚ÄúTableau & distribution‚Äù
function pageTabHome(){
  view(`
    <div class="card">
      ${b("Retour","pageISHome()","btn back")}
      <h2>Tableau & distribution</h2>
      <div class="row" style="margin-top:10px;">
        ${b("1 ¬∑ Pose tableau","pageTabPose()","btn primary")}
        ${b("2 ¬∑ Modulaire","pageTabModulaire()","btn")}
        ${b("3 ¬∑ Commande & pilotage modulaire","pageTabMod_Commandes()","btn")}
      </div>
      <p class="muted" style="margin-top:8px;">Tous les √©l√©ments ajout√©s seront rang√©s dans la pi√®ce ¬´ Tableau ¬ª.</p>
    </div>
  `);
}

/* ========== (1) POSE TABLEAU ========== */

function pageTabPose(){
  view(`
    <div class="card">
      ${b("Retour","pageTabHome()","btn back")}
      <h2>Pose tableau</h2>

      <label>Nombre de rang√©es</label>
      <select id="tp-rang">
        <option value="1" selected>1 rang√©e</option>
        <option value="2">2 rang√©es</option>
        <option value="3">3 rang√©es</option>
        <option value="4">4 rang√©es</option>
      </select>

      <label style="margin-top:8px;">Nombre de modules</label>
      <select id="tp-mod">
        <option value="13" selected>13 modules</option>
        <option value="18">18 modules</option>
        <option value="24">24 modules</option>
      </select>

      <label style="margin-top:8px;">Type de pose</label>
      <select id="tp-pose">
        <option value="Saillie" selected>Saillie</option>
        <option value="Encastr√©">Encastr√©</option>
      </select>

      <label style="margin-top:8px;">Type d‚Äôintervention</label>
      <select id="tp-interv">
        <option value="Cr√©ation" selected>Cr√©ation</option>
        <option value="Avec d√©pose de l‚Äôexistant">Avec d√©pose de l‚Äôexistant</option>
      </select>

      <div class="row" style="margin-top:12px;">
        ${b("Ajouter au devis","addTabPose()","btn primary")}
      </div>
    </div>
  `);
}
function addTabPose(){
  const r   = document.getElementById('tp-rang').value;
  const m   = document.getElementById('tp-mod').value;
  const pos = document.getElementById('tp-pose').value;
  const itv = document.getElementById('tp-interv').value;

  ensureTableau();
  devis["Tableau"].items.push({
    category: "Tableau & distribution",
    intervention: itv,
    pose: pos,
    designation: `Pose tableau ‚Äî ${r} rang√©e(s), ${m} modules`,
    qty: 1,
    prixU: 0
  });
  saveLocal();
  alert("√âl√©ment ajout√© √† ¬´ Tableau ¬ª.");
  pageTabHome();
}

/* ========== (2) MODULAIRE ========== */

function pageTabModulaire(){
  view(`
    <div class="card">
      ${b("Retour","pageTabHome()","btn back")}
      <h2>Modulaire</h2>
      <div class="row" style="margin-top:10px;">
        ${b("A ¬∑ Interrupteurs diff√©rentiels","pageTabMod_ID()","btn primary")}
        ${b("B ¬∑ Disjoncteurs 10/16/20 A","pageTabMod_Disj('B')","btn")}
        ${b("C ¬∑ Disjoncteurs 10/16/20 A (jeu 2)","pageTabMod_Disj('C')","btn")}
        ${b("D ¬∑ Commandes modulaires","pageTabMod_Commandes()","btn")}
        ${b("E ¬∑ Sp√©cifique (libre + prix)","pageTabMod_Specifique()","btn ghost")}
      </div>
    </div>
  `);
}

/* --- A. Interrupteurs diff√©rentiels --- */
function pageTabMod_ID(){
  view(`
    <div class="card">
      ${b("Retour","pageTabModulaire()","btn back")}
      <h2>Interrupteurs diff√©rentiels</h2>

      <div class="list">
        <label>ID 30mA - 40A - Type A
          <input id="id-a-40-30" type="number" min="0" value="0" />
        </label>
        <label>ID 30mA - 40A - Type AC
          <input id="id-ac-40-30" type="number" min="0" value="0" />
        </label>
        <label>ID 30mA - 63A - Type A
          <input id="id-a-63-30" type="number" min="0" value="0" />
        </label>
        <label>ID 30mA - 63A - Type AC
          <input id="id-ac-63-30" type="number" min="0" value="0" />
        </label>
      </div>

      <div class="row" style="margin-top:12px;">
        ${b("Ajouter au devis","submitTabMod_ID()","btn primary")}
      </div>
    </div>
  `);
}
function submitTabMod_ID(){
  const defs = [
    { id:"id-a-40-30",  name:"ID 30mA - 40A - Type A"  },
    { id:"id-ac-40-30", name:"ID 30mA - 40A - Type AC" },
    { id:"id-a-63-30",  name:"ID 30mA - 63A - Type A"  },
    { id:"id-ac-63-30", name:"ID 30mA - 63A - Type AC" }
  ];
  let added = 0;
  ensureTableau();
  defs.forEach(d=>{
    const q = +document.getElementById(d.id).value || 0;
    if(q>0){
      devis["Tableau"].items.push({
        category: "Tableau/Modulaire",
        intervention: "",
        pose: "",
        designation: d.name,
        qty: q,
        prixU: 0
      });
      added++;
    }
  });
  if(!added){ alert("Rien √† ajouter."); return; }
  saveLocal();
  alert("Interrupteurs diff√©rentiels ajout√©s.");
  pageTabModulaire();
}

/* --- B/C. Disjoncteurs 10/16/20A + d√©tail circuits --- */
function pageTabMod_Disj(which){
  view(`
    <div class="card">
      ${b("Retour","pageTabModulaire()","btn back")}
      <h2>${which==='B' ? 'Disjoncteurs 10/16/20 A' : 'Disjoncteurs 10/16/20 A (jeu 2)'}</h2>

      <div class="list">
        <label>Disjoncteurs 10 A (Qt√©)
          <input id="dj-10a" type="number" min="0" value="0" />
          ${b("D√©tail circuits", \`pageTabMod_DisjDetails("${which}",10,document.getElementById('dj-10a').value)\`)}
        </label>
        <label>Disjoncteurs 16 A (Qt√©)
          <input id="dj-16a" type="number" min="0" value="0" />
          ${b("D√©tail circuits", \`pageTabMod_DisjDetails("${which}",16,document.getElementById('dj-16a').value)\`)}
        </label>
        <label>Disjoncteurs 20 A (Qt√©)
          <input id="dj-20a" type="number" min="0" value="0" />
          ${b("D√©tail circuits", \`pageTabMod_DisjDetails("${which}",20,document.getElementById('dj-20a').value)\`)}
        </label>
      </div>

      <div class="row" style="margin-top:12px;">
        ${b("Ajouter au devis (sans d√©tails)", \`submitTabMod_Disj("${which}", null)\`,"btn")}
      </div>
    </div>
  `);
}
function pageTabMod_DisjDetails(which, rating, qtyRaw){
  const qty = Math.max(0, +qtyRaw||0);
  if(!qty){ alert("D√©finis une quantit√© > 0 avant le d√©tail."); return; }

  const fields = Array.from({length:qty},(_,i)=>`
    <input id="dj-name-${rating}-${i}" placeholder="Circuit ${i+1} (ex: Prises salon)"/>
  `).join('');

  view(`
    <div class="card">
      ${b("Retour", \`pageTabMod_Disj("${which}")\`,"btn back")}
      <h2>D√©tail circuits ‚Äî ${rating} A</h2>
      <p class="muted">Renseigne le nom de chaque circuit.</p>
      <div class="list">${fields}</div>

      <div class="row" style="margin-top:12px;">
        ${b("Ajouter ces circuits", \`submitTabMod_DisjDetails("${which}", ${rating}, ${qty})\`,"btn primary")}
      </div>
    </div>
  `);
}
function submitTabMod_DisjDetails(which, rating, qty){
  const names = [];
  for(let i=0;i<qty;i++){
    const v = (document.getElementById(\`dj-name-\${rating}-\${i}\`).value||"").trim();
    names.push(v||\`Circuit \${i+1}\`);
  }
  ensureTableau();
  devis["Tableau"].items.push({
    category: "Tableau/Modulaire",
    intervention: "",
    pose: "",
    designation: \`Disjoncteur \${rating} A ‚Äî circuits : \${names.join(', ')}\`,
    qty: qty,
    prixU: 0
  });
  saveLocal();
  alert(\`Ajout√© : \${qty} √ó Disjoncteur \${rating} A (avec d√©tails).\`);
  pageTabModulaire();
}
function submitTabMod_Disj(which){
  const q10 = +document.getElementById('dj-10a').value || 0;
  const q16 = +document.getElementById('dj-16a').value || 0;
  const q20 = +document.getElementById('dj-20a').value || 0;

  if(!(q10||q16||q20)){ alert("Rien √† ajouter."); return; }

  ensureTableau();
  if(q10) devis["Tableau"].items.push({ category:"Tableau/Modulaire", intervention:"", pose:"", designation:"Disjoncteur 10 A", qty:q10, prixU:0 });
  if(q16) devis["Tableau"].items.push({ category:"Tableau/Modulaire", intervention:"", pose:"", designation:"Disjoncteur 16 A", qty:q16, prixU:0 });
  if(q20) devis["Tableau"].items.push({ category:"Tableau/Modulaire", intervention:"", pose:"", designation:"Disjoncteur 20 A", qty:q20, prixU:0 });

  saveLocal();
  alert("Disjoncteurs ajout√©s.");
  pageTabModulaire();
}

/* ========== (3) COMMANDE & PILOTAGE MODULAIRE ========== */

function pageTabMod_Commandes(){
  view(`
    <div class="card">
      ${b("Retour","pageTabHome()","btn back")}
      <h2>Commande & pilotage modulaire</h2>

      <div class="list">
        <label>T√©l√©rupteur
          <input id="cmd-telerup" type="number" min="0" value="0" />
        </label>
        <label>T√©l√©rupteur silencieux
          <input id="cmd-telerup-sil" type="number" min="0" value="0" />
        </label>
        <label>Horloge m√©canique + Disjoncteur 2A
          <input id="cmd-horloge-2a" type="number" min="0" value="0" />
        </label>
        <label>Horloge m√©canique + contacteur HC + Disjoncteur 2A
          <input id="cmd-horloge-hc-2a" type="number" min="0" value="0" />
        </label>
      </div>

      <div class="row" style="margin-top:12px;">
        ${b("Ajouter au devis","submitTabMod_Commandes()","btn primary")}
      </div>
    </div>
  `);
}
function submitTabMod_Commandes(){
  const defs = [
    { id:"cmd-telerup",        name:"T√©l√©rupteur" },
    { id:"cmd-telerup-sil",    name:"T√©l√©rupteur silencieux" },
    { id:"cmd-horloge-2a",     name:"Horloge m√©canique + Disjoncteur 2A" },
    { id:"cmd-horloge-hc-2a",  name:"Horloge m√©canique + contacteur heures creuses + Disjoncteur 2A" }
  ];
  let added=0;
  ensureTableau();
  defs.forEach(d=>{
    const q=+document.getElementById(d.id).value||0;
    if(q>0){
      devis["Tableau"].items.push({
        category: "Tableau/Commandes",
        intervention: "",
        pose: "",
        designation: d.name,
        qty: q,
        prixU: 0
      });
      added++;
    }
  });
  if(!added){ alert("Rien √† ajouter."); return; }
  saveLocal();
  alert("Commandes modulaires ajout√©es.");
  pageTabHome();
}

/* --- E. Sp√©cifique (libre + prix) --- */
function pageTabMod_Specifique(){
  const label = prompt("Intitul√© de l‚Äô√©l√©ment modulaire (libre) :","");
  if(!label){ pageTabModulaire(); return; }
  const prix  = parseFloat(prompt("Prix unitaire estim√© (‚Ç¨) :","0")) || 0;
  const qty   = Math.max(1, parseInt(prompt("Quantit√© :","1")||"1",10));

  ensureTableau();
  devis["Tableau"].items.push({
    category: "Tableau/Modulaire ‚Äî Sp√©cifique",
    intervention: "",
    pose: "",
    designation: label,
    qty: qty,
    prixU: prix
  });
  saveLocal();
  alert("Ajout√©.");
  pageTabModulaire();
}

/* ============================= */
/* CHAPITRE 7 : ESTIMATIF & EXPORTS (par groupe + complet) */
/* ============================= */
const PIECE_GROUPS = {
  "Buanderie":"Pi√®ces techniques","Garage":"Pi√®ces techniques","Atelier":"Pi√®ces techniques",
  "Jardin":"Ext√©rieur","Terrasse":"Ext√©rieur","Balcon":"Ext√©rieur","Abri de jardin":"Ext√©rieur",
  "Cuisine":"Cuisine",
  "Salon":"Pi√®ces de vie","Salle √† manger":"Pi√®ces de vie","Couloir":"Pi√®ces de vie","Entr√©e":"Pi√®ces de vie",
  "Salle de bain":"Pi√®ces d'eau","Salle d'eau":"Pi√®ces d'eau","Toilettes":"Pi√®ces d'eau",
  "Chambre 1":"Chambres & Bureau","Chambre 2":"Chambres & Bureau","Chambre 3":"Chambres & Bureau","Bureau":"Chambres & Bureau","Biblioth√®que":"Chambres & Bureau",
  "Tableau":"Tableau & distribution","Distribution":"Tableau & distribution","Mise √† la terre":"Mise √† la terre","VMC":"VMC"
};
// Groupage bas√© sur __base (sinon heuristique)
function groupDevis(){
  const g={};
  for(const key in devis){
    if(key.startsWith('__')) continue;
    const s = devis[key];
    const base = (s && s.__base) ? s.__base
      : key.replace(/\s*\(.*\)\s*$/, '').split(' ‚Äî ')[0]; // fallback anciens
    const grp = PIECE_GROUPS[base] || "Divers";
    if(!g[grp]) g[grp] = {};
    g[grp][key] = s;
  }
  return g;
}
// Estimatif
function pageEstimatif(){
  let html = `<div class="card">${b("Retour","pageHome()","btn back")}<h2>Estimatif d√©taill√©</h2>`;
  let totalGlobal=0; const grouped = groupDevis();
  for(const grp in grouped){
    html += `<h2 style="border-top:2px solid #000; padding-top:8px;">${grp}</h2>`;
    let groupTotal=0;
    for(const key in grouped[grp]){
      const s = grouped[grp][key];
      if(!s || !Array.isArray(s.items) || !s.items.length) continue;
      const pieceLabel = formatPieceLabel(key);
      let sectionTotal=0;
      html += `<h3 style="margin-top:6px; border-top:1px solid #ccc; padding-top:4px;">${pieceLabel}</h3><ul>`;
      s.items.forEach(it=>{
        const q=+it.qty||0, pu=+it.prixU||0, t=q*pu;
        sectionTotal+=t; groupTotal+=t; totalGlobal+=t;
        const poseTxt=(it.intervention==="Cr√©ation"&&it.pose)?` ${it.pose.toLowerCase()}`:"";
        const unit=it.unit||"u", left=it.intervention?`${it.intervention} ‚Äî `:"";
        html += `<li>${left}${it.designation}${poseTxt} (${q} ${unit} √ó ${euro(pu)} = ${euro(t)})</li>`;
      });
      if(s.note) html += `<li><em>Note : ${s.note}</em></li>`;
      html += `</ul><p><strong>Total ${pieceLabel} : ${euro(sectionTotal)}</strong></p>`;
    }
    html += `<p><strong>Total ${grp} : ${euro(groupTotal)}</strong></p><hr>`;
  }
  html += `<h3>Total global : ${euro(totalGlobal)}</h3>
           <div class="row" style="margin-top:10px;">
             ${b("Export .txt (par groupe)","exportText()")}
             ${b("Export .zip (par groupe)","exportZipGroups()")}
             ${b("Export .txt (complet)","exportTextFull()")}
             ${b("Export .zip (complet)","exportZipFull()")}
           </div></div>`;
  view(html);
}
// Totaux
function pageTotaux(){
  let html = `<div class="card">${b("Retour","pageHome()","btn back")}<h2>Totaux par groupe</h2>`;
  let totalGlobal=0; const grouped = groupDevis();
  for(const grp in grouped){
    let gt=0;
    for(const key in grouped[grp]){
      const s=grouped[grp][key];
      if(!s || !Array.isArray(s.items) || !s.items.length) continue;
      const st=s.items.reduce((sum,it)=>sum+(((+it.prixU)||0)*((+it.qty)||0)),0);
      gt+=st; totalGlobal+=st;
    }
    html += `<p><strong>${grp}</strong> : ${euro(gt)}</p>`;
  }
  html += `<hr><p><strong>Total global : ${euro(totalGlobal)}</strong></p>
           <div class="row" style="margin-top:10px;">
             ${b("Export .txt (par groupe)","exportText()")}
             ${b("Export .zip (par groupe)","exportZipGroups()")}
             ${b("Export .txt (complet)","exportTextFull()")}
             ${b("Export .zip (complet)","exportZipFull()")}
           </div></div>`;
  view(html);
}
// Helpers export
function itemLine(it){
  const unit = it.unit||"u";
  const poseTxt = (it.intervention==="Cr√©ation" && it.pose) ? ` - ${it.pose.toLowerCase()}` : "";
  const left = it.intervention ? `${it.intervention} ‚Äî ` : "";
  const pu = (+it.prixU||0).toFixed(2), q=+it.qty||0, total=(q*(+it.prixU||0)).toFixed(2);
  return `- ${left}${it.designation}${poseTxt} | Qt√©: ${q} ${unit} | PU: ${pu}‚Ç¨ | Total: ${total}‚Ç¨`;
}
function pieceSeparator(label){ return `\n---------------- ${label} ----------------\n`; }
// TXT par groupe
function exportText(){
  const grouped = groupDevis();
  for(const grp in grouped){
    let lines=[`=== ${grp} ===\n`], groupTotal=0;
    for(const key in grouped[grp]){
      const s=grouped[grp][key];
      if(!s || !Array.isArray(s.items) || !s.items.length) continue;
      const label=formatPieceLabel(key);
      lines.push(pieceSeparator(label));
      let st=0;
      s.items.forEach(it=>{ const q=+it.qty||0, pu=+it.prixU||0, t=q*pu; st+=t; groupTotal+=t; lines.push(itemLine(it)); });
      if(s.note) lines.push(`Note : ${s.note}`);
      lines.push(`Total ${label} : ${st.toFixed(2)}‚Ç¨\n`);
    }
    lines.push(`Total ${grp} : ${groupTotal.toFixed(2)}‚Ç¨`);
    const blob=new Blob([lines.join("\r\n")],{type:"text/plain;charset=utf-8"});
    const url=URL.createObjectURL(blob); const a=document.createElement("a");
    a.href=url; a.download=`devis_${grp}.txt`; a.click(); URL.revokeObjectURL(url);
  }
  alert("‚úÖ Export termin√© : un fichier .txt par groupe g√©n√©r√©.");
}
// ZIP par groupe
async function exportZipGroups(){
  if(typeof JSZip==="undefined"){ alert("JSZip non charg√©."); return; }
  const grouped=groupDevis(); const zip=new JSZip(); let global=0;
  for(const grp in grouped){
    let lines=[`=== ${grp} ===\n`], groupTotal=0;
    for(const key in grouped[grp]){
      const s=grouped[grp][key];
      if(!s || !Array.isArray(s.items) || !s.items.length) continue;
      const label=formatPieceLabel(key);
      lines.push(pieceSeparator(label));
      let st=0;
      s.items.forEach(it=>{ const q=+it.qty||0, pu=+it.prixU||0, t=q*pu; st+=t; groupTotal+=t; lines.push(itemLine(it)); });
      if(s.note) lines.push(`Note : ${s.note}`);
      lines.push(`Total ${label} : ${st.toFixed(2)}‚Ç¨\n`);
    }
    lines.push(`Total ${grp} : ${groupTotal.toFixed(2)}‚Ç¨`);
    global+=groupTotal;
    zip.file(`devis_${grp}.txt`, lines.join("\r\n"));
  }
  const name=(devis.__name||"Devis").trim()||"Devis";
  const readme=[`R√©capitulatif ‚Äî ${name}`,`Date: ${new Date().toLocaleString()}`,"",`Total global: ${global.toFixed(2)}‚Ç¨`,"","Un fichier .txt par groupe avec d√©tails, quantit√©s, PU et totaux.`].join("\r\n");
  zip.file("README.txt", readme);
  const blob=await zip.generateAsync({type:"blob"});
  const url=URL.createObjectURL(blob); const a=document.createElement("a");
  a.href=url; a.download=`${name.replace(/\s+/g,'_').toLowerCase()}_groupes.zip`; a.click();
  URL.revokeObjectURL(url);
  alert("‚úÖ Export ZIP (par groupe) g√©n√©r√©.");
}

/* ===== Exports COMPLETS ===== */
function buildFullText(){
  const grouped = groupDevis();
  let lines = [];
  let globalTotal = 0;

  lines.push(`=== DEVIS COMPLET ===\n`);

  for (const grp in grouped) {
    lines.push(`\n## ${grp} ##\n`);
    let groupTotal = 0;

    for (const key in grouped[grp]) {
      const s = grouped[grp][key];
      if(!s || !Array.isArray(s.items) || !s.items.length) continue;

      const label = formatPieceLabel(key);
      lines.push(pieceSeparator(label));

      let st = 0;
      s.items.forEach(it=>{
        const q=(+it.qty)||0, pu=(+it.prixU)||0, t=q*pu;
        st+=t; groupTotal+=t; globalTotal+=t;
        lines.push(itemLine(it));
      });
      if (s.note) lines.push(`Note : ${s.note}`);
      lines.push(`Total ${label} : ${st.toFixed(2)}‚Ç¨\n`);
    }
    lines.push(`Total ${grp} : ${groupTotal.toFixed(2)}‚Ç¨\n`);
  }

  lines.push(`\n=== Total global : ${globalTotal.toFixed(2)}‚Ç¨ ===\n`);
  return lines.join("\r\n");
}
function exportTextFull(){
  const name = (devis.__name||"Devis").trim()||"Devis";
  const blob = new Blob([buildFullText()], { type:"text/plain;charset=utf-8" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a"); a.href = url;
  a.download = `${name.replace(/\s+/g,'_').toLowerCase()}_complet.txt`; a.click();
  URL.revokeObjectURL(url);
  alert("‚úÖ Export .txt complet g√©n√©r√©.");
}
async function exportZipFull(){
  if (typeof JSZip === "undefined"){ alert("JSZip non charg√©."); return; }
  const name = (devis.__name||"Devis").trim()||"Devis";
  const zip = new JSZip();
  zip.file(`${name.replace(/\s+/g,'_').toLowerCase()}_complet.txt`, buildFullText());
  zip.file(`README.txt`, `Devis complet\nNom: ${name}\nDate: ${new Date().toLocaleString()}\n`);
  const blob = await zip.generateAsync({ type:"blob" });
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a"); a.href = url;
  a.download = `${name.replace(/\s+/g,'_').toLowerCase()}_complet.zip`; a.click();
  URL.revokeObjectURL(url);
  alert("‚úÖ Export .zip complet g√©n√©r√©.");
}

/* ============================= */
/* CHAPITRE 8 : D√âMARRAGE & EXPOSE */
/* ============================= */
function init(){
  try{
    loadLocal();
    pageMain();
  }catch(err){
    const el = document.getElementById('app');
    if (el) el.innerHTML =
      `<div class="card"><h2>Erreur init()</h2><pre>${(err && err.stack) || err}</pre></div>`;
  }
}

// Expose (uniquement ce qui existe)
Object.assign(window, {
  // Menu / sauvegardes
  pageMain, actionNouveauDevis, pageSavedDevis, loadDevis, deleteDevis, saveCurrentDevis,

  // Pi√®ces & flux (chap. 5)
  pageHome, pageAddPiece, confirmPieceChoice, removePiece, goPiece, delLine,
  editPieceNote, pagePieceSpecifique, goCategory, goEclairageSub, setEclairageBranch,
  goIntervention, goDesignation, pageQuantite, saveItem,

  // Installations sp√©cifiques & Tableau (chap. 6)
  pageISHome, isSoon,
  pageTabHome, pageTabPose, addTabPose,
  pageTabModulaire, pageTabMod_ID, submitTabMod_ID,
  pageTabMod_Disj, pageTabMod_DisjDetails, submitTabMod_DisjDetails, submitTabMod_Disj,
  pageTabMod_Commandes, submitTabMod_Commandes, pageTabMod_Specifique,

  // Estimatif & exports (chap. 7)
  pageEstimatif, pageTotaux,
  exportText, exportZipGroups,
  exportTextFull, exportZipFull,

  // Navigation
  confirmBackHome
});

// Lancement
init();
</script>
</main>
</body>
</html>
